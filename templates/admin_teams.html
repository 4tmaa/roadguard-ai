{% extends 'base.html' %}
{% block title %}Team Management{% endblock %}
{% block header_title %}Field Crew Status{% endblock %}

{% block content %}
<style>
    /* 1. KARTU TIM */
    .team-card {
        background-color: var(--bg-panel); /* Ikut Tema */
        border: 1px solid var(--border);
        border-radius: 16px;
        transition: transform 0.2s, box-shadow 0.2s;
        height: 100%;
        overflow: hidden;
        position: relative;
    }
    
    .team-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px -5px rgba(0,0,0,0.1);
        border-color: var(--blue); /* Highlight biru saat hover */
    }

    /* 2. ICON AVATAR */
    .avatar-circle {
        width: 70px; 
        height: 70px;
        background-color: var(--bg-dark);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 15px auto;
        border: 2px solid var(--border);
        color: var(--blue);
    }

    /* 3. TEKS */
    .team-name {
        color: var(--text);
        font-weight: 700;
        margin-bottom: 2px;
    }
    .team-contact {
        color: var(--text-muted);
        font-size: 13px;
    }

    /* 4. DROPDOWN STATUS */
    .custom-select {
        background-color: var(--bg-dark);
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 8px 12px;
        width: 100%;
        cursor: pointer;
        font-size: 14px;
    }
    .custom-select:focus {
        border-color: var(--blue);
        outline: none;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }

    /* 5. INDIKATOR STATUS VISUAL (Garis atas kartu) */
    .status-line { height: 4px; width: 100%; position: absolute; top: 0; left: 0; }
    .line-available { background: var(--green); }
    .line-busy { background: var(--red); }
    .line-maint { background: var(--yellow); }

    /* 6. BADGES */
    .status-badge {
        font-size: 11px; 
        padding: 4px 10px; 
        border-radius: 20px; 
        font-weight: 600;
        display: inline-block;
        margin-top: 10px;
    }
    .badge-av { background: rgba(16, 185, 129, 0.15); color: var(--green); border: 1px solid rgba(16, 185, 129, 0.2); }
    .badge-busy { background: rgba(239, 68, 68, 0.15); color: var(--red); border: 1px solid rgba(239, 68, 68, 0.2); }
    .badge-maint { background: rgba(245, 158, 11, 0.15); color: var(--yellow); border: 1px solid rgba(245, 158, 11, 0.2); }

</style>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show mb-4" role="alert" 
           style="background: rgba(16, 185, 129, 0.1); border: 1px solid var(--green); color: var(--green);">
        <i class="fa-solid fa-circle-check me-2"></i> {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="row g-4">
    {% for team in teams %}
    <div class="col-md-6 col-lg-3">
        <div class="team-card p-4 text-center">
            
            <div class="status-line 
                {% if team.status=='Available' %}line-available
                {% elif team.status=='Busy' %}line-busy
                {% else %}line-maint{% endif %}">
            </div>

            <div class="avatar-circle">
                <i class="fa-solid fa-user-astronaut fa-2x"></i>
            </div>
            
            <h5 class="team-name">{{ team.name }}</h5>
            <p class="team-contact"><i class="fa-solid fa-phone me-1"></i> {{ team.contact }}</p>
            
            <form action="/admin/teams" method="POST" class="mt-4">
                <input type="hidden" name="team_id" value="{{ team.id }}">
                
                <div class="mb-2 text-start small fw-bold" style="color: var(--text-muted);">Set Status:</div>
                <select name="status" class="custom-select" onchange="this.form.submit()">
                    <option value="Available" {% if team.status=='Available' %}selected{% endif %}>ðŸŸ¢ Available</option>
                    <option value="Busy" {% if team.status=='Busy' %}selected{% endif %}>ðŸ”´ Busy (On Mission)</option>
                    <option value="Maintenance" {% if team.status=='Maintenance' %}selected{% endif %}>ðŸŸ¡ Maintenance</option>
                </select>
            </form>

            <div class="mt-3">
                {% if team.status == 'Available' %} 
                    <span class="status-badge badge-av">Ready to Dispatch</span>
                {% elif team.status == 'Busy' %} 
                    <span class="status-badge badge-busy">Currently Deployed</span>
                {% else %} 
                    <span class="status-badge badge-maint">Vehicle Repair</span>
                {% endif %}
            </div>

        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}